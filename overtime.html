<!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 700;
    }

    .header p {
        font-size: 1.1em;
        opacity: 0.9;
    }

    .main-content {
        padding: 40px;
    }

    .upload-section {
        background: #f8f9fa;
        border: 3px dashed #dee2e6;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        margin-bottom: 30px;
        transition: all 0.3s ease;
    }

    .upload-section:hover {
        border-color: #3498db;
        background: #e8f4f8;
    }

    .upload-section.dragover {
        border-color: #27ae60;
        background: #e8f5e8;
    }

    .upload-button {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1.1em;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px;
    }

    .upload-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }

    .file-input {
        display: none;
    }

    .settings-section {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        display: none;
    }

    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .setting-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .setting-card h3 {
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 1.2em;
    }

    .input-group {
        margin-bottom: 15px;
    }

    .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
    }

    .input-group input, .input-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
        transition: border-color 0.3s ease;
    }

    .input-group input:focus, .input-group select:focus {
        outline: none;
        border-color: #3498db;
    }

    .employee-rates {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
    }

    .employee-rate-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        border-bottom: 1px solid #eee;
        transition: background-color 0.3s ease;
    }

    .employee-rate-item:hover {
        background: #f8f9fa;
    }

    .employee-rate-item:last-child {
        border-bottom: none;
    }

    .employee-name {
        font-weight: 600;
        color: #2c3e50;
        flex: 1;
    }

    .rate-input {
        width: 150px;
        padding: 8px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        text-align: center;
        font-size: 0.9em;
    }

    .calculate-button {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 1.2em;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        margin: 20px auto;
    }

    .calculate-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
    }

    .results-section {
        display: none;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 30px;
        margin-top: 30px;
    }

    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .summary-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }

    .summary-card:hover {
        transform: translateY(-5px);
    }

    .summary-card h3 {
        font-size: 1.1em;
        color: #666;
        margin-bottom: 10px;
    }

    .summary-card .value {
        font-size: 2em;
        font-weight: bold;
        color: #2c3e50;
    }

    .summary-card.total .value {
        color: #27ae60;
    }

    .results-table {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .table-header {
        background: linear-gradient(135deg, #34495e, #2c3e50);
        color: white;
        padding: 20px;
        text-align: center;
    }

    .table-content {
        max-height: 600px;
        overflow-y: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 15px;
        text-align: center;
        border-bottom: 1px solid #eee;
    }

    th {
        background: #f8f9fa;
        font-weight: 600;
        color: #2c3e50;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    tr:hover {
        background: #f8f9fa;
    }

    .overtime-hours {
        color: #e74c3c;
        font-weight: 600;
    }

    .overtime-pay {
        color: #27ae60;
        font-weight: 600;
    }

    .export-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
    }

    .export-button {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .export-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #666;
    }

    .loading::after {
        content: "";
        display: inline-block;
        width: 30px;
        height: 30px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border: 1px solid #f5c6cb;
    }

    .success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border: 1px solid #c3e6cb;
    }

    @media (max-width: 768px) {
        .main-content {
            padding: 20px;
        }
        
        .settings-grid {
            grid-template-columns: 1fr;
        }
        
        .summary-cards {
            grid-template-columns: 1fr;
        }
        
        .export-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        table {
            font-size: 0.9em;
        }
        
        th, td {
            padding: 10px 8px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h1>
            <p>Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ù…Ù„ÙØ§Øª Excel Ùˆ CSV</p>
        </div>

```
    <div class="main-content">
        <!-- Ù‚Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù -->
        <div class="upload-section" id="uploadSection">
            <h2>ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <p>Ø§Ø®ØªØ± Ù…Ù„Ù Excel (.xlsx, .xls) Ø£Ùˆ CSV ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" />
            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù
            </button>
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù ÙˆØ£ÙÙ„ØªÙ‡ Ù‡Ù†Ø§
            </p>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div class="settings-section" id="settingsSection">
            <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
            <div class="settings-grid">
                <div class="setting-card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</h3>
                    <div class="input-group">
                        <label for="normalHours">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© (ÙŠÙˆÙ…ÙŠØ§Ù‹)</label>
                        <input type="number" id="normalHours" value="9" min="1" max="24" />
                    </div>
                    <div class="input-group">
                        <label for="overtimeMultiplier">Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</label>
                        <input type="number" id="overtimeMultiplier" value="1.5" min="1" max="5" step="0.1" readonly />
                        <small style="color: #666; font-size: 0.8em;">Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø«Ø§Ø¨Øª 1.5 Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…</small>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h3>
                    <div class="input-group">
                        <label for="weekdayEndTime">ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ - Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <input type="time" id="weekdayEndTime" value="02:15" />
                    </div>
                    <div class="input-group">
                        <label for="weekendEndTime">ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ - Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <input type="time" id="weekendEndTime" value="02:15" />
                    </div>
                    <div class="input-group">
                        <label for="weekendDays">Ø£ÙŠØ§Ù… Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</label>
                        <select id="weekendDays">
                            <option value="thursday-friday" selected>Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø©</option>
                            <option value="friday-saturday">Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª</option>
                            <option value="saturday-sunday">Ø§Ù„Ø³Ø¨Øª ÙˆØ§Ù„Ø£Ø­Ø¯</option>
                            <option value="friday-only">Ø§Ù„Ø¬Ù…Ø¹Ø© ÙÙ‚Ø·</option>
                            <option value="saturday-only">Ø§Ù„Ø³Ø¨Øª ÙÙ‚Ø·</option>
                            <option value="sunday-only">Ø§Ù„Ø£Ø­Ø¯ ÙÙ‚Ø·</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="applyTimeAdjustment">
                            <input type="checkbox" id="applyTimeAdjustment" checked style="width: auto; margin-left: 10px;" />
                            ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø®Ø±ÙˆØ¬ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…
                        </label>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                    <div class="input-group">
                        <label for="holidayOvertimeMultiplier">Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</label>
                        <input type="number" id="holidayOvertimeMultiplier" value="1.5" min="1" max="5" step="0.1" readonly />
                        <small style="color: #666; font-size: 0.8em;">Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø«Ø§Ø¨Øª 1.5 Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù…</small>
                    </div>
                    <div class="input-group">
                        <label for="holidayMode">Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</label>
                        <select id="holidayMode">
                            <option value="full_overtime">ÙƒØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ</option>
                            <option value="after_normal">Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©</option>
                        </select>
                        <small style="color: #666; font-size: 0.8em;">
                            ÙƒØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© ØªØ­Ø³Ø¨ Ø¥Ø¶Ø§ÙÙŠØ©<br>
                            Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©: Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                        </small>
                    </div>
                    <div class="input-group">
                        <label for="applyHolidayRules">
                            <input type="checkbox" id="applyHolidayRules" checked style="width: auto; margin-left: 10px;" />
                            ØªØ·Ø¨ÙŠÙ‚ Ù‚ÙˆØ§Ø¹Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                        </label>
                    </div>
                    
                    <div class="employee-holidays" id="employeeHolidays">
                        <h4>Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù</h4>
                        <div id="employeeHolidaysList">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                        </div>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®</h3>
                    <div class="input-group">
                        <label for="dateRange">Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                        <select id="dateRange">
                            <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</option>
                            <option value="month">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                            <option value="custom">Ù†Ø·Ø§Ù‚ Ù…Ø®ØµØµ</option>
                        </select>
                    </div>
                    <div class="input-group" id="customDateRange" style="display: none;">
                        <label for="startDate">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="startDate" />
                        <label for="endDate">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" id="endDate" />
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø§ØªØ¨</h3>
                    <div class="input-group">
                        <label for="currency">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                        <select id="currency">
                            <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                            <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                            <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                            <option value="AED">Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ (AED)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="defaultRate">Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</label>
                        <input type="number" id="defaultRate" value="4.16" min="1" step="0.01" />
                    </div>
                </div>
            </div>

            <div class="employee-rates" id="employeeRates">
                <h3>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                <div id="employeeRatesList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                </div>
            </div>

            <button class="calculate-button" onclick="calculateOvertime()">
                ğŸ’° Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="results-section" id="resultsSection">
            <h2>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h2>
            
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                    <div class="value" id="totalEmployees">0</div>
                </div>
                <div class="summary-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>
                    <div class="value" id="totalOvertimeHours">0</div>
                </div>
                <div class="summary-card total">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</h3>
                    <div class="value" id="totalOvertimePay">0</div>
                </div>
            </div>

            <div class="results-table">
                <div class="table-header">
                    <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù</h3>
                </div>
                <div class="table-content">
                    <table id="summaryTable">
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª</th>
                                <th>ÙˆØ±Ø¯ÙŠØ§Øª Ø¹Ø§Ø¯ÙŠØ©</th>
                                <th>ÙˆØ±Ø¯ÙŠØ§Øª Ø¥Ø¬Ø§Ø²Ø©</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
                                <th>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="results-table" style="margin-top: 30px;">
                <div class="table-header">
                    <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                    <div class="table-controls">
                        <div class="filter-controls">
                            <input type="text" id="employeeFilter" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…..." class="filter-input">
                            <select id="branchFilter" class="filter-select" style="display: none;">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</option>
                            </select>
                            <select id="dayTypeFilter" class="filter-select">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£ÙŠØ§Ù…</option>
                                <option value="ÙŠÙˆÙ… Ø¹Ù…Ù„">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</option>
                                <option value="Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                                <option value="ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©">Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</option>
                            </select>
                            <input type="date" id="dateFromFilter" class="filter-input" placeholder="Ù…Ù† ØªØ§Ø±ÙŠØ®">
                            <input type="date" id="dateToFilter" class="filter-input" placeholder="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®">
                            <button onclick="clearFilters()" class="clear-filters-btn">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
                            <button onclick="exportFilteredData()" class="export-filtered-btn">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙÙ„ØªØ±</button>
                        </div>
                    </div>
                </div>
                <div class="table-content">
                    <table id="resultsTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)" class="sortable">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(1)" class="sortable">Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(2)" class="sortable">Ø§Ù„ØªØ§Ø±ÙŠØ® <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(3)" class="sortable">Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ… <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(4)" class="sortable">ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ± <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(5)" class="sortable">ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ØµÙ„ÙŠ <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(6)" class="sortable">ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„ <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(7)" class="sortable">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(8)" class="sortable">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(9)" class="sortable">Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© <span class="sort-icon">â†•ï¸</span></th>
                                <th onclick="sortTable(10)" class="sortable">Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© <span class="sort-icon">â†•ï¸</span></th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                        </tbody>
                    </table>
                </div>
                <div class="table-footer">
                    <div class="pagination-info">
                        <span id="tableInfo">Ø¹Ø±Ø¶ 0 Ù…Ù† 0 Ø³Ø¬Ù„</span>
                    </div>
                </div>
            </div>

            <div class="export-buttons">
                <button class="export-button" onclick="exportToExcel()">
                    ğŸ“„ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„ Ø¥Ù„Ù‰ Excel
                </button>
                <button class="export-button" onclick="exportSummaryToExcel()">
                    ğŸ“Š ØªØµØ¯ÙŠØ± Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¥Ù„Ù‰ Excel
                </button>
                <button class="export-button" onclick="exportToCSV()">
                    ğŸ“ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV
                </button>
                <button class="export-button" onclick="printReport()">
                    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
    let employeeData = [];
    let processedData = [];
    let filteredData = [];
    let currentSort = { column: -1, direction: 'asc' };

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    const uploadSection = document.getElementById('uploadSection');
    const fileInput = document.getElementById('fileInput');

    uploadSection.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadSection.classList.add('dragover');
    });

    uploadSection.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadSection.classList.remove('dragover');
    });

    uploadSection.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadSection.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFile(files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleFile(e.target.files[0]);
        }
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØµØµ
    document.getElementById('dateRange').addEventListener('change', function() {
        const customRange = document.getElementById('customDateRange');
        if (this.value === 'custom') {
            customRange.style.display = 'block';
        } else {
            customRange.style.display = 'none';
        }
    });

    function handleFile(file) {
        const fileName = file.name.toLowerCase();
        const fileType = file.type;

        showLoading();

        if (fileName.endsWith('.csv') || fileType === 'text/csv') {
            handleCSVFile(file);
        } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls') || 
                   fileType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                   fileType === 'application/vnd.ms-excel') {
            handleExcelFile(file);
        } else {
            showError('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„Ù Excel Ø£Ùˆ CSV.');
            hideLoading();
        }
    }

    function handleCSVFile(file) {
        Papa.parse(file, {
            header: true,
            encoding: 'UTF-8',
            skipEmptyLines: true,
            complete: function(results) {
                if (results.errors.length > 0) {
                    showError('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + results.errors[0].message);
                    hideLoading();
                    return;
                }
                
                processFileData(results.data);
                hideLoading();
            },
            error: function(error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
                hideLoading();
            }
        });
    }

    function handleExcelFile(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                processFileData(jsonData);
                hideLoading();
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
                hideLoading();
            }
        };
        reader.readAsArrayBuffer(file);
    }

    function processFileData(data) {
        if (!data || data.length === 0) {
            showError('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©');
            return;
        }

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§
        const rawData = data.map(row => {
            const keys = Object.keys(row);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const nameKey = keys.find(k => k.includes('Ù…Ø³ØªØ®Ø¯Ù…') || k.includes('Ø§Ø³Ù…') || k.includes('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'));
            const branchKey = keys.find(k => k.includes('ÙØ±Ø¹') || k.includes('Ø§Ù„ÙØ±Ø¹'));
            const checkinKey = keys.find(k => k.includes('Ø­Ø¶ÙˆØ±') || k.includes('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±'));
            const checkoutKey = keys.find(k => k.includes('Ø§Ù†ØµØ±Ø§Ù') || k.includes('Ø§Ù„Ø¥Ù†ØµØ±Ø§Ù'));
            const durationKey = keys.find(k => k.includes('Ù…Ø¯Ø©') || k.includes('Ø§Ù„ÙˆØ±Ø¯ÙŠØ©'));

            return {
                name: row[nameKey] || '',
                branch: row[branchKey] || '',
                checkin: row[checkinKey] || '',
                checkout: row[checkoutKey] || '',
                duration: row[durationKey] || ''
            };
        }).filter(row => row.name && row.name.trim() !== '');

        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ§Ø­Ø¯
        const groupedData = {};
        rawData.forEach(row => {
            const date = parseArabicDate(row.checkin);
            const dateKey = `${row.name}_${date.toDateString()}`;
            
            if (!groupedData[dateKey]) {
                groupedData[dateKey] = [];
            }
            groupedData[dateKey].push(row);
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©
        employeeData = [];
        Object.values(groupedData).forEach(dayRecords => {
            if (dayRecords.length === 1) {
                // ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ø­Ø¯ ÙÙŠ Ø§Ù„ÙŠÙˆÙ…
                employeeData.push(dayRecords[0]);
            } else {
                // ØªØ³Ø¬ÙŠÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© - Ù†Ø£Ø®Ø° Ø§Ù„Ø£Ù‚Ø¯Ù… Ù„Ù„Ø¯Ø®ÙˆÙ„
                const sortedRecords = dayRecords.sort((a, b) => {
                    const timeA = parseArabicDateTime(a.checkin);
                    const timeB = parseArabicDateTime(b.checkin);
                    return timeA - timeB;
                });
                
                const earliestRecord = sortedRecords[0];
                employeeData.push(earliestRecord);
            }
        });

        if (employeeData.length === 0) {
            showError('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù');
            return;
        }

        // Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        document.getElementById('settingsSection').style.display = 'block';
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        createEmployeeRatesList();
        
        showSuccess(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ${employeeData.length} ÙˆØ±Ø¯ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­`);
    }

    function createEmployeeRatesList() {
        const employeeNames = [...new Set(employeeData.map(row => row.name))];
        const employeeRatesList = document.getElementById('employeeRatesList');
        const employeeHolidaysList = document.getElementById('employeeHolidaysList');
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        employeeRatesList.innerHTML = '';
        employeeHolidaysList.innerHTML = '';
        
        employeeNames.forEach(name => {
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù…
            let defaultRate = 4.16; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            if (name === 'Ù…Ø§Ù‡Ø± Ø¹Ø§Ø¯Ù„') {
                defaultRate = 10.41;
            } else if (name === 'Ø£Ø¯Ù‡Ù…' || name === 'Mohd Saber') {
                defaultRate = 4.16;
            }
            
            // Ø¹Ù†ØµØ± Ø§Ù„Ø³Ø¹Ø±
            const rateItem = document.createElement('div');
            rateItem.className = 'employee-rate-item';
            rateItem.innerHTML = `
                <span class="employee-name">${name}</span>
                <input type="number" class="rate-input" value="${defaultRate}" min="1" step="0.01" 
                       data-employee="${name}" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©">
            `;
            employeeRatesList.appendChild(rateItem);
            
            // Ø¹Ù†ØµØ± ÙŠÙˆÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
            const holidayItem = document.createElement('div');
            holidayItem.className = 'employee-holiday-item';
            holidayItem.innerHTML = `
                <span class="employee-name">${name}</span>
                <select class="holiday-select" data-employee="${name}">
                    <option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©</option>
                    <option value="0">Ø§Ù„Ø£Ø­Ø¯</option>
                    <option value="1">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                    <option value="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                    <option value="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                    <option value="4">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                    <option value="5">Ø§Ù„Ø¬Ù…Ø¹Ø©</option>
                    <option value="6">Ø§Ù„Ø³Ø¨Øª</option>
                </select>
            `;
            employeeHolidaysList.appendChild(holidayItem);
        });
    }

    function calculateOvertime() {
        if (employeeData.length === 0) {
            showError('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        const normalHours = parseFloat(document.getElementById('normalHours').value);
        const overtimeMultiplier = parseFloat(document.getElementById('overtimeMultiplier').value);
        const currency = document.getElementById('currency').value;
        const applyTimeAdjustment = document.getElementById('applyTimeAdjustment').checked;
        const weekdayEndTime = document.getElementById('weekdayEndTime').value;
        const weekendEndTime = document.getElementById('weekendEndTime').value;
        const weekendDays = document.getElementById('weekendDays').value;
        const applyHolidayRules = document.getElementById('applyHolidayRules').checked;
        const holidayOvertimeMultiplier = 1.5; // Ø«Ø§Ø¨Øª
        const holidayMode = document.getElementById('holidayMode').value;
        
        // Ø¬Ù…Ø¹ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const employeeRates = {};
        document.querySelectorAll('.rate-input').forEach(input => {
            const employeeName = input.getAttribute('data-employee');
            employeeRates[employeeName] = parseFloat(input.value) || 0;
        });
        
        // Ø¬Ù…Ø¹ Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const employeeHolidays = {};
        document.querySelectorAll('.holiday-select').forEach(select => {
            const employeeName = select.getAttribute('data-employee');
            const holidayDay = select.value;
            if (holidayDay !== '') {
                employeeHolidays[employeeName] = parseInt(holidayDay);
            }
        });

        // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
        processedData = [];
        
        employeeData.forEach(row => {
            const shiftDate = parseArabicDate(row.checkin);
            const dayOfWeek = shiftDate.getDay();
            const isWeekend = isWeekendDay(shiftDate, weekendDays);
            const isHoliday = applyHolidayRules && employeeHolidays[row.name] === dayOfWeek;
            
            let dayType = 'ÙŠÙˆÙ… Ø¹Ù…Ù„';
            if (isHoliday) {
                dayType = 'ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©';
            } else if (isWeekend) {
                dayType = 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹';
            }
            
            const originalDuration = parseDuration(row.duration);
            let adjustedDuration = originalDuration;
            let adjustedCheckout = row.checkout;
            let overtimeHours = 0;
            let usedMultiplier = 1.5; // Ø«Ø§Ø¨Øª Ø¯Ø§Ø¦Ù…Ø§Ù‹
            
            // Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„ (Ø¯Ø§Ø¦Ù…Ø§Ù‹ 2:15)
            if (applyTimeAdjustment) {
                const checkinTime = parseArabicDateTime(row.checkin);
                const targetEndTime = "02:15"; // Ø«Ø§Ø¨Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…
                const adjustedCheckoutTime = calculateAdjustedCheckout(checkinTime, targetEndTime, normalHours);
                
                adjustedCheckout = formatArabicDateTime(adjustedCheckoutTime);
                adjustedDuration = calculateHoursBetween(checkinTime, adjustedCheckoutTime);
            }
            
            if (isHoliday && applyHolidayRules) {
                // Ø­Ø³Ø§Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
                if (holidayMode === 'full_overtime') {
                    // ÙƒØ§Ù…Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ
                    overtimeHours = adjustedDuration; // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø¯Ù„
                } else {
                    // Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                    overtimeHours = Math.max(0, adjustedDuration - normalHours);
                }
            } else {
                // Ø­Ø³Ø§Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                overtimeHours = Math.max(0, adjustedDuration - normalHours);
            }
            
            const rate = employeeRates[row.name] || 0;
            const overtimePay = overtimeHours * rate * usedMultiplier;
            
            processedData.push({
                name: row.name,
                branch: row.branch,
                date: formatDateForDisplay(shiftDate),
                dayName: getDayName(shiftDate),
                dayType: dayType,
                checkin: row.checkin,
                originalCheckout: row.checkout,
                adjustedCheckout: adjustedCheckout,
                originalDuration: originalDuration,
                adjustedDuration: adjustedDuration,
                overtimeHours: overtimeHours,
                overtimePay: overtimePay,
                rate: rate,
                currency: currency,
                multiplier: usedMultiplier,
                isHoliday: isHoliday
            });
        });

        displayResults();
    }

    function isWeekendDay(date, weekendDays) {
        const dayOfWeek = date.getDay(); // 0 = Ø§Ù„Ø£Ø­Ø¯, 1 = Ø§Ù„Ø§Ø«Ù†ÙŠÙ†, ..., 6 = Ø§Ù„Ø³Ø¨Øª
        
        switch (weekendDays) {
            case 'thursday-friday':
                return dayOfWeek === 4 || dayOfWeek === 5; // Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø©
            case 'friday-saturday':
                return dayOfWeek === 5 || dayOfWeek === 6; // Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª
            case 'saturday-sunday':
                return dayOfWeek === 6 || dayOfWeek === 0; // Ø§Ù„Ø³Ø¨Øª ÙˆØ§Ù„Ø£Ø­Ø¯
            case 'friday-only':
                return dayOfWeek === 5; // Ø§Ù„Ø¬Ù…Ø¹Ø© ÙÙ‚Ø·
            case 'saturday-only':
                return dayOfWeek === 6; // Ø§Ù„Ø³Ø¨Øª ÙÙ‚Ø·
            case 'sunday-only':
                return dayOfWeek === 0; // Ø§Ù„Ø£Ø­Ø¯ ÙÙ‚Ø·
            default:
                return false;
        }
    }

    function parseArabicDate(arabicDateStr) {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Date
        const months = {
            'ÙŠÙ†Ø§ÙŠØ±': 0, 'ÙØ¨Ø±Ø§ÙŠØ±': 1, 'Ù…Ø§Ø±Ø³': 2, 'Ø£Ø¨Ø±ÙŠÙ„': 3, 'Ù…Ø§ÙŠÙˆ': 4, 'ÙŠÙˆÙ†ÙŠÙˆ': 5,
            'ÙŠÙˆÙ„ÙŠÙˆ': 6, 'Ø£ØºØ³Ø·Ø³': 7, 'Ø³Ø¨ØªÙ…Ø¨Ø±': 8, 'Ø£ÙƒØªÙˆØ¨Ø±': 9, 'Ù†ÙˆÙÙ…Ø¨Ø±': 10, 'Ø¯ÙŠØ³Ù…Ø¨Ø±': 11
        };
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
        const parts = arabicDateStr.split('ØŒ ')[0].split(' ');
        const monthName = parts[0];
        const day = parseInt(parts[1]);
        const year = new Date().getFullYear(); // Ø§ÙØªØ±Ø§Ø¶ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        
        return new Date(year, months[monthName] || 0, day);
    }

    function parseArabicDateTime(arabicDateTimeStr) {
        const parts = arabicDateTimeStr.split('ØŒ ');
        const datePart = parts[0];
        const timePart = parts[1];
        
        const date = parseArabicDate(arabicDateTimeStr);
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª
        let hours, minutes;
        if (timePart.includes('Øµ')) {
            const time = timePart.replace('Øµ', '').trim().split(':');
            hours = parseInt(time[0]);
            minutes = parseInt(time[1]) || 0;
            if (hours === 12) hours = 0; // 12 Øµ = Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
        } else if (timePart.includes('Ù…')) {
            const time = timePart.replace('Ù…', '').trim().split(':');
            hours = parseInt(time[0]);
            minutes = parseInt(time[1]) || 0;
            if (hours !== 12) hours += 12; // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… 24 Ø³Ø§Ø¹Ø©
        }
        
        date.setHours(hours, minutes, 0, 0);
        return date;
    }

    function calculateAdjustedCheckout(checkinTime, targetEndTime, normalHours) {
        const [targetHours, targetMinutes] = targetEndTime.split(':').map(Number);
        
        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (Ø¯Ø§Ø¦Ù…Ø§Ù‹ 2:15)
        const targetCheckout = new Date(checkinTime);
        targetCheckout.setHours(targetHours, targetMinutes, 0, 0);
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ù‚Ø¨Ù„ ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±ØŒ ÙÙ‡Ùˆ ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        if (targetCheckout <= checkinTime) {
            targetCheckout.setDate(targetCheckout.getDate() + 1);
        }
        
        // Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù†Ø¹ÙŠØ¯ 2:15 Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        return targetCheckout;
    }

    function calculateHoursBetween(startTime, endTime) {
        const diffMs = endTime - startTime;
        return Math.max(0, diffMs / (1000 * 60 * 60)); // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø³Ø§Ø¹Ø§Øª
    }

    function formatArabicDateTime(date) {
        const months = [
            'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
            'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
        ];
        
        const day = date.getDate().toString().padStart(2, '0');
        const month = months[date.getMonth()];
        const hours = date.getHours();
        const minutes = date.getMinutes().toString().padStart(2, '0');
        
        let displayHours = hours;
        let period = 'Øµ';
        
        if (hours === 0) {
            displayHours = 12;
            period = 'Øµ';
        } else if (hours === 12) {
            displayHours = 12;
            period = 'Ù…';
        } else if (hours > 12) {
            displayHours = hours - 12;
            period = 'Ù…';
        }
        
        return `${month} ${day}ØŒ ${displayHours}:${minutes}${period}`;
    }

    function formatDateForDisplay(date) {
        const months = [
            'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
            'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
        ];
        
        const day = date.getDate().toString().padStart(2, '0');
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${day} ${month} ${year}`;
    }

    function getDayName(date) {
        const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
        return days[date.getDay()];
    }

    function formatDuration(hours) {
        const totalMinutes = Math.round(hours * 60);
        const hrs = Math.floor(totalMinutes / 60);
        const mins = totalMinutes % 60;
        return `${hrs}:${mins.toString().padStart(2, '0')}`;
    }

    function parseDuration(durationStr) {
        if (!durationStr) return 0;
        
        const parts = durationStr.split(':');
        if (parts.length === 2) {
            const hours = parseInt(parts[0]) || 0;
            const minutes = parseInt(parts[1]) || 0;
            return hours + (minutes / 60);
        }
        
        return 0;
    }

    function displayResults() {
        const resultsSection = document.getElementById('resultsSection');
        resultsSection.style.display = 'block';

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…
        const totalEmployees = [...new Set(processedData.map(row => row.name))].length;
        const totalOvertimeHours = processedData.reduce((sum, row) => sum + row.overtimeHours, 0);
        const totalOvertimePay = processedData.reduce((sum, row) => sum + row.overtimePay, 0);
        const currency = document.getElementById('currency').value;

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…
        document.getElementById('totalEmployees').textContent = totalEmployees;
        document.getElementById('totalOvertimeHours').textContent = totalOvertimeHours.toFixed(2);
        document.getElementById('totalOvertimePay').textContent = formatCurrency(totalOvertimePay, currency);

        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ù…ÙˆØ¸Ù
        const employeeSummary = {};
        processedData.forEach(row => {
            if (!employeeSummary[row.name]) {
                employeeSummary[row.name] = {
                    name: row.name,
                    branch: row.branch,
                    shiftsCount: 0,
                    normalShifts: 0,
                    holidayShifts: 0,
                    totalOriginalHours: 0,
                    totalAdjustedHours: 0,
                    totalOvertimeHours: 0,
                    totalOvertimePay: 0,
                    rate: row.rate
                };
            }
            
            employeeSummary[row.name].shiftsCount += 1;
            if (row.isHoliday) {
                employeeSummary[row.name].holidayShifts += 1;
            } else {
                employeeSummary[row.name].normalShifts += 1;
            }
            employeeSummary[row.name].totalOriginalHours += row.originalDuration;
            employeeSummary[row.name].totalAdjustedHours += row.adjustedDuration;
            employeeSummary[row.name].totalOvertimeHours += row.overtimeHours;
            employeeSummary[row.name].totalOvertimePay += row.overtimePay;
        });

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù„Ø®Øµ Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const summaryTableBody = document.getElementById('summaryTableBody');
        summaryTableBody.innerHTML = '';

        Object.values(employeeSummary).forEach(emp => {
            const summaryRow = document.createElement('tr');
            summaryRow.innerHTML = `
                <td><strong>${emp.name}</strong></td>
                <td>${emp.shiftsCount}</td>
                <td>${emp.normalShifts}</td>
                <td class="holiday-shifts">${emp.holidayShifts}</td>
                <td>${formatDuration(emp.totalOriginalHours)}</td>
                <td class="adjusted-hours">${formatDuration(emp.totalAdjustedHours)}</td>
                <td class="overtime-hours">${formatDuration(emp.totalOvertimeHours)}</td>
                <td>${formatCurrency(emp.rate, currency)}</td>
                <td class="overtime-pay"><strong>${formatCurrency(emp.totalOvertimePay, currency)}</strong></td>
            `;
            summaryTableBody.appendChild(summaryRow);
        });

        // Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
        filteredData = [...processedData];
        setupTableFilters();
        displayTableData();

        // Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        if (!document.getElementById('dynamicStyles')) {
            const style = document.createElement('style');
            style.id = 'dynamicStyles';
            style.textContent = `
                .day-type {
                    padding: 4px 8px;
                    border-radius: 12px;
                    font-size: 0.8em;
                    font-weight: bold;
                }
                .day-type.weekday {
                    background: #e3f2fd;
                    color: #1976d2;
                }
                .day-type.weekend {
                    background: #fce4ec;
                    color: #c2185b;
                }
                
                .day-type.holiday {
                    background: #fff3e0;
                    color: #f57c00;
                    border: 1px solid #ffb74d;
                }
                .adjusted-time {
                    background: #f0f8ff;
                    font-weight: 600;
                    color: #2c5aa0;
                }
                .adjusted-hours {
                    background: #f0f8ff;
                    font-weight: 600;
                    color: #2c5aa0;
                }
                #summaryTable tbody tr {
                    background: #f8f9fa;
                    border-left: 4px solid #3498db;
                }
                #summaryTable tbody tr:hover {
                    background: #e9ecef;
                }
                
                .holiday-shifts {
                    background: #fff3e0;
                    color: #f57c00;
                    font-weight: bold;
                }
                
                .employee-holidays {
                    background: white;
                    border-radius: 10px;
                    padding: 20px;
                    margin-top: 20px;
                    border: 2px solid #e3f2fd;
                }
                
                .employee-holiday-item {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 12px 15px;
                    border-bottom: 1px solid #eee;
                    transition: background-color 0.3s ease;
                }
                
                .employee-holiday-item:hover {
                    background: #f8f9fa;
                }
                
                .employee-holiday-item:last-child {
                    border-bottom: none;
                }
                
                .multiplier-value {
                    background: #e8f5e8;
                    color: #2e7d32;
                    font-weight: bold;
                    text-align: center;
                }
                
                .table-controls {
                    background: white;
                    padding: 15px;
                    border-bottom: 1px solid #dee2e6;
                }
                
                .filter-controls {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 10px;
                    align-items: center;
                }
                
                .filter-input, .filter-select {
                    padding: 8px 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 6px;
                    font-size: 0.9em;
                    min-width: 120px;
                }
                
                .filter-input:focus, .filter-select:focus {
                    outline: none;
                    border-color: #3498db;
                }
                
                .clear-filters-btn, .export-filtered-btn {
                    background: linear-gradient(135deg, #e74c3c, #c0392b);
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.9em;
                    transition: all 0.3s ease;
                }
                
                .export-filtered-btn {
                    background: linear-gradient(135deg, #16a085, #1abc9c);
                }
                
                .clear-filters-btn:hover, .export-filtered-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
                }
                
                .sortable {
                    cursor: pointer;
                    user-select: none;
                    position: relative;
                    transition: background-color 0.3s ease;
                }
                
                .sortable:hover {
                    background: #e9ecef;
                }
                
                .sort-icon {
                    font-size: 0.8em;
                    margin-right: 5px;
                    opacity: 0.6;
                }
                
                .sortable.asc .sort-icon::after {
                    content: "â†‘";
                    color: #3498db;
                    font-weight: bold;
                }
                
                .sortable.desc .sort-icon::after {
                    content: "â†“";
                    color: #3498db;
                    font-weight: bold;
                }
                
                .table-footer {
                    background: #f8f9fa;
                    padding: 10px 15px;
                    border-top: 1px solid #dee2e6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .pagination-info {
                    font-size: 0.9em;
                    color: #666;
                }
                
                .filtered-row {
                    animation: fadeIn 0.3s ease;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                .no-results {
                    text-align: center;
                    padding: 40px;
                    color: #666;
                    font-style: italic;
                }
                
                @media (max-width: 768px) {
                    .filter-controls {
                        flex-direction: column;
                        align-items: stretch;
                    }
                    
                    .filter-input, .filter-select {
                        min-width: auto;
                        width: 100%;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        resultsSection.scrollIntoView({ behavior: 'smooth' });
    }

    function formatCurrency(amount, currency) {
        const symbols = {
            'SAR': 'Ø±.Ø³',
            'USD': '$',
            'EUR': 'â‚¬',
            'AED': 'Ø¯.Ø¥'
        };
        
        return `${amount.toFixed(2)} ${symbols[currency] || currency}`;
    }

    function exportToExcel() {
        if (processedData.length === 0) {
            showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            return;
        }

        const currency = document.getElementById('currency').value;
        const ws_data = [
            ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø§Ù„ÙØ±Ø¹', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…', 'ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ØµÙ„ÙŠ', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', 'Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©'],
            ...processedData.map(row => [
                row.name,
                row.branch,
                row.date,
                row.dayType,
                row.checkin,
                row.originalCheckout,
                row.adjustedCheckout,
                row.originalDuration.toFixed(2),
                row.adjustedDuration.toFixed(2),
                row.overtimeHours.toFixed(2),
                row.overtimePay.toFixed(2)
            ])
        ];

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙˆØ¯
        const range = XLSX.utils.decode_range(ws['!ref']);
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const address = XLSX.utils.encode_col(C) + "1";
            if (!ws[address]) continue;
            ws[address].s = {
                font: { bold: true },
                alignment: { horizontal: "center" }
            };
        }

        XLSX.utils.book_append_sheet(wb, ws, "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø§Ù„Ù…ÙØµÙ„");
        XLSX.writeFile(wb, `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø³Ø§Ø¹Ø§Øª_Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©_Ù…ÙØµÙ„_${new Date().toISOString().split('T')[0]}.xlsx`);
    }

    function exportToCSV() {
        if (processedData.length === 0) {
            showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            return;
        }

        const csvContent = [
            ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø§Ù„ÙØ±Ø¹', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…', 'ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ØµÙ„ÙŠ', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', 'Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©'],
            ...processedData.map(row => [
                row.name,
                row.branch,
                row.date,
                row.dayType,
                row.checkin,
                row.originalCheckout,
                row.adjustedCheckout,
                row.originalDuration.toFixed(2),
                row.adjustedDuration.toFixed(2),
                row.overtimeHours.toFixed(2),
                row.overtimePay.toFixed(2)
            ])
        ].map(row => row.join(',')).join('\n');

        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø³Ø§Ø¹Ø§Øª_Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©_Ù…ÙØµÙ„_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function exportSummaryToExcel() {
        if (processedData.length === 0) {
            showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
            return;
        }

        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ù…ÙˆØ¸Ù
        const employeeSummary = {};
        processedData.forEach(row => {
            if (!employeeSummary[row.name]) {
                employeeSummary[row.name] = {
                    name: row.name,
                    branch: row.branch,
                    shiftsCount: 0,
                    totalOriginalHours: 0,
                    totalAdjustedHours: 0,
                    totalOvertimeHours: 0,
                    totalOvertimePay: 0,
                    rate: row.rate
                };
            }
            
            employeeSummary[row.name].shiftsCount += 1;
            employeeSummary[row.name].totalOriginalHours += row.originalDuration;
            employeeSummary[row.name].totalAdjustedHours += row.adjustedDuration;
            employeeSummary[row.name].totalOvertimeHours += row.overtimeHours;
            employeeSummary[row.name].totalOvertimePay += row.overtimePay;
        });

        const ws_data = [
            ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø§Ù„ÙØ±Ø¹', 'Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', 'Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚'],
            ...Object.values(employeeSummary).map(emp => [
                emp.name,
                emp.branch,
                emp.shiftsCount,
                emp.totalOriginalHours.toFixed(2),
                emp.totalAdjustedHours.toFixed(2),
                emp.totalOvertimeHours.toFixed(2),
                emp.rate.toFixed(2),
                emp.totalOvertimePay.toFixed(2)
            ])
        ];

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙˆØ¯
        const range = XLSX.utils.decode_range(ws['!ref']);
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const address = XLSX.utils.encode_col(C) + "1";
            if (!ws[address]) continue;
            ws[address].s = {
                font: { bold: true },
                alignment: { horizontal: "center" }
            };
        }

        XLSX.utils.book_append_sheet(wb, ws, "Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†");
        XLSX.writeFile(wb, `Ù…Ù„Ø®Øµ_Ø§Ù„Ø³Ø§Ø¹Ø§Øª_Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©_Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†_${new Date().toISOString().split('T')[0]}.xlsx`);
    }

    function setupTableFilters() {
        // Ø¥Ø¹Ø¯Ø§Ø¯ ÙÙ„ØªØ± Ø§Ù„ÙØ±ÙˆØ¹
        const branches = [...new Set(processedData.map(row => row.branch))];
        const branchFilter = document.getElementById('branchFilter');
        branchFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹</option>';
        branches.forEach(branch => {
            const option = document.createElement('option');
            option.value = branch;
            option.textContent = branch;
            branchFilter.appendChild(option);
        });

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„ÙÙ„Ø§ØªØ±
        document.getElementById('employeeFilter').addEventListener('input', applyFilters);
        document.getElementById('branchFilter').addEventListener('change', applyFilters);
        document.getElementById('dayTypeFilter').addEventListener('change', applyFilters);
        document.getElementById('dateFromFilter').addEventListener('change', applyFilters);
        document.getElementById('dateToFilter').addEventListener('change', applyFilters);
    }

    function applyFilters() {
        const employeeFilter = document.getElementById('employeeFilter').value.toLowerCase();
        const branchFilter = document.getElementById('branchFilter').value;
        const dayTypeFilter = document.getElementById('dayTypeFilter').value;
        const dateFromFilter = document.getElementById('dateFromFilter').value;
        const dateToFilter = document.getElementById('dateToFilter').value;

        filteredData = processedData.filter(row => {
            // ÙÙ„ØªØ± Ø§Ù„Ø§Ø³Ù…
            const nameMatch = !employeeFilter || row.name.toLowerCase().includes(employeeFilter);
            
            // ÙÙ„ØªØ± Ø§Ù„ÙØ±Ø¹
            const branchMatch = !branchFilter || row.branch === branchFilter;
            
            // ÙÙ„ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…
            const dayTypeMatch = !dayTypeFilter || row.dayType === dayTypeFilter;
            
            // ÙÙ„ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
            let dateMatch = true;
            if (dateFromFilter || dateToFilter) {
                const rowDate = parseDisplayDate(row.date);
                if (dateFromFilter) {
                    const fromDate = new Date(dateFromFilter);
                    dateMatch = dateMatch && (rowDate >= fromDate);
                }
                if (dateToFilter) {
                    const toDate = new Date(dateToFilter);
                    dateMatch = dateMatch && (rowDate <= toDate);
                }
            }
            
            return nameMatch && branchMatch && dayTypeMatch && dateMatch;
        });

        displayTableData();
        updateTableInfo();
    }

    function parseDisplayDate(dateStr) {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Date
        const months = {
            'ÙŠÙ†Ø§ÙŠØ±': 0, 'ÙØ¨Ø±Ø§ÙŠØ±': 1, 'Ù…Ø§Ø±Ø³': 2, 'Ø£Ø¨Ø±ÙŠÙ„': 3, 'Ù…Ø§ÙŠÙˆ': 4, 'ÙŠÙˆÙ†ÙŠÙˆ': 5,
            'ÙŠÙˆÙ„ÙŠÙˆ': 6, 'Ø£ØºØ³Ø·Ø³': 7, 'Ø³Ø¨ØªÙ…Ø¨Ø±': 8, 'Ø£ÙƒØªÙˆØ¨Ø±': 9, 'Ù†ÙˆÙÙ…Ø¨Ø±': 10, 'Ø¯ÙŠØ³Ù…Ø¨Ø±': 11
        };
        
        const parts = dateStr.split(' ');
        const day = parseInt(parts[0]);
        const month = months[parts[1]];
        const year = parseInt(parts[2]);
        
        return new Date(year, month, day);
    }

    function clearFilters() {
        document.getElementById('employeeFilter').value = '';
        document.getElementById('branchFilter').value = '';
        document.getElementById('dayTypeFilter').value = '';
        document.getElementById('dateFromFilter').value = '';
        document.getElementById('dateToFilter').value = '';
        
        filteredData = [...processedData];
        displayTableData();
        updateTableInfo();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ±ØªÙŠØ¨
        currentSort = { column: -1, direction: 'asc' };
        document.querySelectorAll('.sortable').forEach(th => {
            th.classList.remove('asc', 'desc');
        });
    }

    function displayTableData() {
        const tableBody = document.getElementById('resultsTableBody');
        const currency = document.getElementById('currency').value;
        
        if (filteredData.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="11" class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</td></tr>';
            return;
        }

        tableBody.innerHTML = '';
        filteredData.forEach(row => {
            const tableRow = document.createElement('tr');
            tableRow.className = 'filtered-row';
            
            let dayTypeClass = 'weekday';
            if (row.dayType === 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹') dayTypeClass = 'weekend';
            if (row.dayType === 'ÙŠÙˆÙ… Ø¥Ø¬Ø§Ø²Ø©') dayTypeClass = 'holiday';
            
            tableRow.innerHTML = `
                <td>${row.name}</td>
                <td>${row.dayName}</td>
                <td>${row.date}</td>
                <td><span class="day-type ${dayTypeClass}">${row.dayType}</span></td>
                <td>${row.checkin}</td>
                <td>${row.originalCheckout}</td>
                <td class="adjusted-time">${row.adjustedCheckout}</td>
                <td>${formatDuration(row.originalDuration)}</td>
                <td class="adjusted-hours">${formatDuration(row.adjustedDuration)}</td>
                <td class="overtime-hours">${formatDuration(row.overtimeHours)}</td>
                <td class="overtime-pay">${formatCurrency(row.overtimePay, currency)}</td>
            `;
            tableBody.appendChild(tableRow);
        });
    }

    function updateTableInfo() {
        const totalRecords = processedData.length;
        const filteredRecords = filteredData.length;
        const infoText = `Ø¹Ø±Ø¶ ${filteredRecords} Ù…Ù† ${totalRecords} Ø³Ø¬Ù„`;
        document.getElementById('tableInfo').textContent = infoText;
    }

    function sortTable(columnIndex) {
        const headers = document.querySelectorAll('.sortable');
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        headers.forEach(header => header.classList.remove('asc', 'desc'));
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØªØ±ØªÙŠØ¨
        if (currentSort.column === columnIndex) {
            currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
        } else {
            currentSort.direction = 'asc';
        }
        currentSort.column = columnIndex;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        headers[columnIndex].classList.add(currentSort.direction);
        
        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        filteredData.sort((a, b) => {
            let valueA, valueB;
            
            switch (columnIndex) {
                case 0: // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù
                    valueA = a.name;
                    valueB = b.name;
                    break;
                case 1: // Ø§Ù„ÙØ±Ø¹
                    valueA = a.branch;
                    valueB = b.branch;
                    break;
                case 2: // Ø§Ù„ØªØ§Ø±ÙŠØ®
                    valueA = parseDisplayDate(a.date);
                    valueB = parseDisplayDate(b.date);
                    break;
                case 3: // Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…
                    valueA = a.dayType;
                    valueB = b.dayType;
                    break;
                case 4: // ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±
                    valueA = a.checkin;
                    valueB = b.checkin;
                    break;
                case 5: // ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ØµÙ„ÙŠ
                    valueA = a.originalCheckout;
                    valueB = b.originalCheckout;
                    break;
                case 6: // ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„
                    valueA = a.adjustedCheckout;
                    valueB = b.adjustedCheckout;
                    break;
                case 7: // Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©
                    valueA = a.originalDuration;
                    valueB = b.originalDuration;
                    break;
                case 8: // Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
                    valueA = a.adjustedDuration;
                    valueB = b.adjustedDuration;
                    break;
                case 9: // Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                    valueA = a.overtimeHours;
                    valueB = b.overtimeHours;
                    break;
                case 10: // Ø§Ù„Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ù…Ø·Ø¨Ù‚
                    valueA = a.multiplier;
                    valueB = b.multiplier;
                    break;
                case 11: // Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
                    valueA = a.overtimePay;
                    valueB = b.overtimePay;
                    break;
                default:
                    return 0;
            }
            
            if (typeof valueA === 'string' && typeof valueB === 'string') {
                valueA = valueA.toLowerCase();
                valueB = valueB.toLowerCase();
            }
            
            if (valueA < valueB) return currentSort.direction === 'asc' ? -1 : 1;
            if (valueA > valueB) return currentSort.direction === 'asc' ? 1 : -1;
            return 0;
        });
        
        displayTableData();
    }

    function exportFilteredData() {
        if (filteredData.length === 0) {
            showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ„ØªØ±Ø© Ù„Ù„ØªØµØ¯ÙŠØ±');
            return;
        }

        const ws_data = [
            ['Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù', 'Ø§Ù„ÙØ±Ø¹', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ù†ÙˆØ¹ Ø§Ù„ÙŠÙˆÙ…', 'ÙˆÙ‚Øª Ø§Ù„Ø­Ø¶ÙˆØ±', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø£ØµÙ„ÙŠ', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¹Ø¯Ù„', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©', 'Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©', 'Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©'],
            ...filteredData.map(row => [
                row.name,
                row.branch,
                row.date,
                row.dayType,
                row.checkin,
                row.originalCheckout,
                row.adjustedCheckout,
                row.originalDuration.toFixed(2),
                row.adjustedDuration.toFixed(2),
                row.overtimeHours.toFixed(2),
                row.overtimePay.toFixed(2)
            ])
        ];

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¹Ù…ÙˆØ¯
        const range = XLSX.utils.decode_range(ws['!ref']);
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const address = XLSX.utils.encode_col(C) + "1";
            if (!ws[address]) continue;
            ws[address].s = {
                font: { bold: true },
                alignment: { horizontal: "center" }
            };
        }

        XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©");
        XLSX.writeFile(wb, `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©_${new Date().toISOString().split('T')[0]}.xlsx`);
        
        showSuccess(`ØªÙ… ØªØµØ¯ÙŠØ± ${filteredData.length} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­`);
    }

    function printReport() {
        if (processedData.length === 0) {
            showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
            return;
        }

        const currency = document.getElementById('currency').value;
        const totalEmployees = processedData.length;
        const totalOvertimeHours = processedData.reduce((sum, emp) => sum + emp.overtimeHours, 0);
        const totalOvertimePay = processedData.reduce((sum, emp) => sum + emp.overtimePay, 0);

        const printContent = `
            <!DOCTYPE html>
            <html lang="ar" dir="rtl">
            <head>
                <meta charset="UTF-8">
                <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; }
                    .header { text-align: center; margin-bottom: 30px; }
                    .summary { display: flex; justify-content: space-around; margin-bottom: 30px; }
                    .summary-item { text-align: center; }
                    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
                    th { background-color: #f2f2f2; }
                    .overtime-hours { color: #e74c3c; font-weight: bold; }
                    .overtime-pay { color: #27ae60; font-weight: bold; }
                    @media print { 
                        body { margin: 0; }
                        .no-print { display: none; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h1>
                    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}</p>
                </div>
                
                <div class="summary">
                    <div class="summary-item">
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                        <p>${totalEmployees}</p>
                    </div>
                    <div class="summary-item">
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h3>
                        <p>${totalOvertimeHours.toFixed(2)}</p>
                    </div>
                    <div class="summary-item">
                        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚</h3>
                        <p>${formatCurrency(totalOvertimePay, currency)}</p>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
                            <th>Ø§Ù„ÙØ±Ø¹</th>
                            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª</th>
                            <th>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
                            <th>Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${processedData.map(emp => `
                            <tr>
                                <td>${emp.name}</td>
                                <td>${emp.branch}</td>
                                <td>${emp.totalHours.toFixed(2)}</td>
                                <td>${emp.regularHours.toFixed(2)}</td>
                                <td class="overtime-hours">${emp.overtimeHours.toFixed(2)}</td>
                                <td>${formatCurrency(emp.rate, currency)}</td>
                                <td class="overtime-pay">${formatCurrency(emp.overtimePay, currency)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </body>
            </html>
        `;

        const printWindow = window.open('', '_blank');
        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.print();
    }

    function showLoading() {
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...</div>';
    }

    function hideLoading() {
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.innerHTML = `
            <h2>ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
            <p>Ø§Ø®ØªØ± Ù…Ù„Ù Excel (.xlsx, .xls) Ø£Ùˆ CSV ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</p>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.csv" />
            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù
            </button>
            <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù ÙˆØ£ÙÙ„ØªÙ‡ Ù‡Ù†Ø§
            </p>
        `;
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        const newFileInput = document.getElementById('fileInput');
        newFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
    }

    function showError(message) {
        const existing = document.querySelector('.error');
        if (existing) existing.remove();
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.textContent = message;
        document.querySelector('.main-content').appendChild(errorDiv);
        
        setTimeout(() => errorDiv.remove(), 5000);
    }

    function showSuccess(message) {
        const existing = document.querySelector('.success');
        if (existing) existing.remove();
        
        const successDiv = document.createElement('div');
        successDiv.className = 'success';
        successDiv.textContent = message;
        document.querySelector('.main-content').appendChild(successDiv);
        
        setTimeout(() => successDiv.remove(), 5000);
    }

    // ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    document.getElementById('defaultRate').addEventListener('input', function() {
        const newRate = this.value;
        document.querySelectorAll('.rate-input').forEach(input => {
            if (input.value === '' || input.value === '0') {
                input.value = newRate;
            }
        });
    });

    // Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙˆØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø®ØµØµ
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    document.getElementById('startDate').valueAsDate = firstDay;
    document.getElementById('endDate').valueAsDate = today;

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
    function loadSampleData() {
        const sampleData = [
            {
                name: 'Ù…Ø§Ù‡Ø± Ø¹Ø§Ø¯Ù„',
                branch: 'Ø§Ù„Ù‡ÙÙˆÙ',
                checkin: 'ÙŠÙˆÙ†ÙŠÙˆ 02ØŒ 02:29Ù…',
                checkout: 'ÙŠÙˆÙ†ÙŠÙˆ 03ØŒ 02:25Øµ',
                duration: '11:55'
            },
            {
                name: 'Mohd Saber',
                branch: 'Ø§Ù„Ù‡ÙÙˆÙ',
                checkin: 'ÙŠÙˆÙ†ÙŠÙˆ 10ØŒ 02:53Ù…',
                checkout: 'ÙŠÙˆÙ†ÙŠÙˆ 11ØŒ 02:37Øµ',
                duration: '11:43'
            },
            {
                name: 'Ø£Ø¯Ù‡Ù…',
                branch: 'Ø§Ù„Ù‡ÙÙˆÙ',
                checkin: 'ÙŠÙˆÙ†ÙŠÙˆ 16ØŒ 02:42Ù…',
                checkout: 'ÙŠÙˆÙ†ÙŠÙˆ 17ØŒ 02:49Øµ',
                duration: '12:06'
            }
        ];

        employeeData = sampleData;
        document.getElementById('settingsSection').style.display = 'block';
        createEmployeeRatesList();
        showSuccess('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
    }

    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
    setTimeout(() => {
        const uploadSection = document.getElementById('uploadSection');
        const testButton = document.createElement('button');
        testButton.className = 'upload-button';
        testButton.textContent = 'ğŸ§ª ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±';
        testButton.onclick = loadSampleData;
        uploadSection.appendChild(testButton);
    }, 1000);
</script>
```

</body>
</html>